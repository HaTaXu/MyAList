import{a as O,b as ee,aS as x,b5 as y,k as d,c3 as re,e,a3 as te,bL as se,S as b,af as G,bw as c,bj as p,I as j,a7 as F,ad as C,av as S,au as k,bl as ne,bm as ae,aH as M,B as I,bq as oe,br as ie,bs as T,E as D,bt as le,bu as ce,bM as ue,aC as de,c1 as q,b6 as v,n as pe,ah as L}from"./index.0f128fa7.js";import{G as ge,H as he,I as me}from"./index.a01b3991.js";import{a as fe}from"./FolderTree.b23f4d91.js";import{a as _e}from"./user_group.fea77ba8.js";import"./index.36085931.js";const J=L('<input type="password" hidden autocomplete="new-password">'),be=L('<span class="hope-select__placeholder hope-c-gYjErV hope-c-cNask hope-c-PJLV hope-c-PJLV-ijhzIfm-css"></span>'),we=L('<div class="hope-select__value hope-c-gYjErV hope-c-PJLV hope-c-PJLV-ijhzIfm-css"></div>'),$e=t=>{const w=O();return e(c,{display:"inline-flex",flexDirection:"row",alignItems:"center",gap:"$2",rounded:"$md",shadow:"$md",p:"$2",w:"fit-content",get children(){return[e(p,{mb:"0",get children(){return w(`users.permissions.${t.name}`)}}),e(q,{get checked(){return t.can},onChange:()=>t.onChange(!t.can)})]}})},Le=()=>{const t=O(),{params:w,back:P}=ee(),{id:g}=w,[z,H]=x(()=>y.get("/admin/user_group/list")),[i,R]=d([]),[Y,A]=d([]),N=[],E=new Map([]),V=new Map([]);(async()=>{const r=await H();v(r,s=>R(s.content));for(let s=0;s<i().length;s++)N.push(i()[s].user_group_name),E.set(i()[s].user_group_name,i()[s].base_path),V.set(i()[s].user_group_name,i()[s].permission);A(N)})();const[u,$]=d(""),[n,a]=re({id:0,username:"",password:"",user_group:"",base_path:"/",role:0,permission:0,disabled:!1,sso_id:""}),[m,f]=d(""),[h,_]=d(0),[X,K]=x(()=>y.get(`/admin/user/get?id=${g}`));g&&(async()=>{const r=await K();v(r,a),$(n.user_group),f(n.base_path),_(n.permission)})();const[Q,W]=x(()=>y.post(`/admin/user/${g?"update":"create"}`,n)),[B,U]=d("false");return e(F,{get loading(){return X()},get children(){return e(te,{w:"$full",alignItems:"start",spacing:"$2",get children(){return[e(se,{get children(){return t(`global.${g?"edit":"add"}`)}}),e(b,{get when(){return!G.is_guest(n)},get children(){return[e(c,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(p,{for:"username",display:"flex",alignItems:"center",get children(){return t("users.username")}}),J.cloneNode(!0),e(j,{id:"username",get value(){return n.username},onInput:r=>a("username",r.currentTarget.value)})]}}),e(c,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(p,{for:"password",display:"flex",alignItems:"center",get children(){return t("users.password")}}),J.cloneNode(!0),e(j,{id:"password",type:"password",placeholder:"********",get value(){return n.password},onInput:r=>a("password",r.currentTarget.value)})]}})]}}),e(b,{get when(){return!G.is_admin(n)},get children(){return[e(F,{get loading(){return z()},get children(){return e(c,{w:"$full",display:"flex",flexDirection:"column",get children(){return[e(p,{for:"user_group",get children(){return e(C,{spacing:"$2",get children(){return[S(()=>t("users.select_user_group")),e(b,{get when(){return S(()=>u()!="",!0)()&&!Y().includes(u())},get children(){return e(C,{color:"$danger9",spacing:"$1",get children(){return[e(k,{as:ge}),S(()=>t("users.user_group_not_exist"))]}})}})]}})}}),e(ne,{id:"user_group",onChange:function(r){$(r),a("user_group",u);const s=E.get(u()),o=V.get(u());s!=null&&o!=null&&(f(s),_(o),a("base_path",m),a("permission",h))},get children(){return[e(ae,{css:{".hope-c-gYjErV":{flexGrow:"1",flexShrink:"1",textAlign:"start",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},".hope-c-cNask":{color:"var(--hope-colors-neutral9)",opacity:"1"}},get children(){return[e(b,{get when(){return n.user_group==""},get fallback(){return(()=>{const r=we.cloneNode(!0);return M(r,()=>n.user_group),r})()},get children(){const r=be.cloneNode(!0);return M(r,()=>t("global.choose")),r}}),e(I,{height:"1.4em",width:"1.4em",borderRadius:"0.7em",paddingLeft:"0",paddingRight:"0",colorScheme:"neutral",onMouseEnter:()=>U("true"),onMouseLeave:()=>U("false"),onClick:function(r){r.stopPropagation(),$(""),f("/"),_(0),a("user_group",u),a("base_path",m),a("permission",h);const s=document.getElementById("user_group-trigger"),o=s.firstChild;if(o!=null&&o.nodeName=="DIV"){const l=document.createElement("span"),Z=document.createTextNode("\u9009\u62E9");l.setAttribute("class","hope-select__placeholder hope-c-gYjErV hope-c-cNask hope-c-PJLV hope-c-PJLV-ijhzIfm-css"),l.appendChild(Z),s.replaceChild(l,o)}},css:{".display":{display:"none"}},get children(){return[e(k,{get classList(){return{display:B()==="true"}},height:"1.4em",width:"1.4em",as:he}),e(k,{get classList(){return{display:B()==="false"}},height:"1.4em",width:"1.4em",as:me})]}})]}}),e(oe,{get children(){return e(ie,{get children(){return[e(T,{get value(){return n.user_group},display:"none",get children(){return t(n.user_group)}}),e(D,{get each(){return i()},children:r=>e(T,{get value(){return r.user_group_name},get disabled(){return r.disabled},get children(){return[e(le,{get children(){return t(r.user_group_name)}}),e(ce,{})]}})})]}})}})]}})]}})}}),e(c,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(p,{for:"base_path",display:"flex",alignItems:"center",get children(){return t("users.base_path")}}),e(fe,{id:"base_path",get value(){return m()},onChange:r=>{f(r),a("base_path",m)},onlyFolder:!0})]}}),e(c,{w:"$full",get children(){return[e(p,{display:"flex",alignItems:"center",get children(){return t("users.permission")}}),e(ue,{w:"$full",wrap:"wrap",gap:"$2",get children(){return e(D,{each:de,children:(r,s)=>e($e,{name:r,get can(){return _e.can(h(),s())},onChange:o=>{let l=h();o?l|=1<<s():l&=~(1<<s()),_(l),a("permission",h)}})})}})]}}),e(c,{w:"fit-content",display:"flex",get children(){return e(q,{css:{whiteSpace:"nowrap"},id:"disabled",onChange:r=>a("disabled",r.currentTarget.checked),color:"$neutral10",fontSize:"$sm",get checked(){return n.disabled},get children(){return t("users.disabled")}})}})]}}),e(C,{spacing:"$2",get children(){return[e(I,{colorScheme:"accent",get loading(){return Q()},onClick:async()=>{const r=await W();v(r,()=>{pe.success(t("global.save_success")),P()})},get children(){return t(`global.${g?"save":"add"}`)}}),e(I,{onClick:async()=>{P()},get children(){return t("global.back")}})]}})]}})}})};export{Le as default};
